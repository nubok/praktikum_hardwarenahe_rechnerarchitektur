\documentclass[10pt]{scrartcl}
\usepackage[latin1]{inputenc}
\usepackage[english, ngerman]{babel}
\usepackage[babel]{csquotes}
\usepackage{amsmath} % for eqref
\usepackage{tabularx}
\usepackage{pst-circ, pstricks-add}
\usepackage{graphicx}
\author{Denis Dietze \and Wolfgang Keller \and Nico Linke \and Thomas Schulte}

\title{Protokoll Versuch IT2}
\subtitle{Microcontroller Z8}
\begin{document}
\maketitle

\section{Port-1-Komplex}

\subsection{Konfiguration von Port 0 zur Speichererweiterung durch 256 Byte externen RAM}

Wir m"ussen in das Register \verb|P01M| den Bin"arwert \verb|XX0100XX| schreiben, wobei X f"ur einen beliebiges Bit steht. In der Lösung in Abschnitt \ref{sec:1d}, in welcher man die Assemblerl"osung sehen kann, haben wir uns f"ur \verb|10h| entschieden.

\subsection{Adressen zum Zugriff auf den externen RAM}

Die Adressen des externen RAMs sind ab 4096 (\verb|0x1000|). % Ist dies korrekt?
Da 256 Byte externer RAM vorliegt, sind somit die Adressen des externen RAMs \verb|0x1000-0x10FF|.

\subsection{Befehle zum Zugriff auf den RAM}

\ldots % Inhalte einfuegen

\subsection{Teilaufgabe d} % TODO Bessere Ueberschrift
\label{sec:1d}

\begin{verbatim}
ORG 0Ch
0Ch:  LD P01M, 10h   % Port 0 initialisieren; Register 248 ist P01M
      % wir wollen SP auf 1100h setzen, somit ist 
      % SPL auf 00h auf SPH auf 11h zu setzen
      LD SPL, 00h
      LD SPH, 11h
      CALL 500h
      STOP           % oder sollte man HLT verwenden?
ORG 500h
500h: RET
\end{verbatim}

Die R"uckkehradresse liegt dann in der Adresse \verb|0x10FE| auf dem Stack, da der Program Counter 2 Bytes benötigt und entsprechend durch den \verb|CALL|-Befehl wie in Anlage 9 beschrieben der Stack Pointer \verb|SP| um 2 erniedrigt wird und in dieser Adresse der Program Counter \verb|PC| abgespeichert wird.

\section{Port-0-/Port-2-Komplex}

\subsection{Teilaufgabe a} % TODO Bessere Ueberschrift

\begin{verbatim}
ORG 0Ch
0Ch:   LD P01M, 0h % Port 0 initialisieren
       LD P2M, FFh % Port 2 initialisieren
label: LD 2, 0     % Wert von Port 0 in Port 2 schreiben
       JP label    % dies in einer Endlosschleife machen
\end{verbatim}

\subsection{Teilaufgabe b} % TODO Bessere Ueberschrift

\begin{verbatim}
ORG 0Ch
% Initialisierung
0Ch:   LD P01M, 0h  % Port 0 initialisieren; P01M
       LD P3M, 1h  $ Port 2 auf Push-pull setzen
       LD P2M, 0h  % Port 2 initialisieren
       
       % Registerbelegung:
       % Register 5: Wert von Port 2
       % Register 4: Wert von Port 0
       
       LDC 5, 8h   % Wert 8 (genau oberstes Bit gesetzt) in Port 2 schreiben
       LDC 4, 0h   % Wert 0 (keine LED an) in Port 0 schreiben
      

% Eigentliches Programm
begin:
       LD 2, 5     % Werte in Ports schreiben
       LD 0, 4
       
       % wenn Register 5 den Wert 0 hat, springe nach port0
       JP 5, port2 % ???
       JP port0

port2:
       RCF         % Carry-Flag loeschen
       RRC 5       % Register 5 nach rechts rotieren, C hat
                   % den Wert 0, also kein Problem
       % wenn Register 5 nicht 0 ist, springe nach begin
       JP 5, begin % ???
       LDC 4, 1    % 1 in Port 0 in Zukunft
       
port0: 
       % Wenn wir hier ankommen, hat Register 4 (in Zukunft Port 0) 
       % sicherlich nicht den Wert 0
       RCF         % Carry-Flag loeschen
       RLC 4       % Register 4 nach links rotieren, C hat
                   % den Wert 0, also kein Problem
       % wenn Register 4 nicht 0 ist, springe nach begin
       JP 4, begin % ???
       % Register 4 ist also 0. Wir setzen also Register 5 mit
       % Wert 8 (hoechste LED an)
       LDC 5, 8h
       JP begin    % ... und springen dann zurueck zum Anfang
\end{verbatim}

\section{Timer-0-Komplex/Pulsbreitenmodulator}

\subsection{Kontrollfragen}

\subsubsection{Betriebsart Modulo N}

Unter der Betriebsart Modulo N versteht man, dass nach N Pulsen an der Eingabe ein Puls an der Ausgabe erzeugt wird

\subsubsection{Frage 2}  % TODO bessere Uebrschrift

\begin{displaymath}
\frac{8~MHz}{16 \cdot 257} = 1,9453~kHz
\end{displaymath}

\subsubsection{Mittelwert des PWM-Signals bei einem Eingabewert von 0 sowie 255, wobei die Pulsamplitude 5 V betragen soll}

Bezeichne $x$ die relative Pulsbreite der Low-Phase. Dann gilt f"ur den Mittelwert des PWM-Signals:

\begin{displaymath}
\left(1-\frac{x}{257}\right)\cdot 5~V.
\end{displaymath}

\subsection{Software f"ur Pulsbreitenmodulator}

\begin{verbatim}
ORG 0Ch
% Initialisierung
0Ch:   LD TMR,  F1h % Timer initialisieren
       LD PRE0, 41h % Prescaler 0 auf 16 setzen (16*4+1)
       ...
\end{verbatim}

\section{Timer-1-Komplex}

\section{UART (SIO)-Komplex}

\subsection{Teil a} % TODO bessere Uebrschrift

\subsection{Initialisierung von UART f"ur eine Baudrate von 9600 Bd}

\subsection{Teil c} % TODO bessere Uebrschrift

\section{P33/P34/IRQ-1-Komplex}

\subsection{Teil a} % TODO bessere Uebrschrift

\begin{verbatim}
ORG 01h
                    % 2 Bytes: Adresse der Interrupt Service Routine zu 
                    % Interrupt 1
DB 2h               % upper byte
DB 0h               % lower byte


ORG 0Ch
% Initialisierung
0Ch:   

ORG 200h
isr1:               % Interrupt Service Routine fuer IRQ 1
       ...
       IRET         % Beendet Interrupt-Verarbeitung

\end{verbatim}

\subsection{Teil b} % TODO bessere Uebrschrift

\end{document}